<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Validation de Ticket</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }
    #qr-reader {
      width: 300px;
      margin: auto;
    }
    #result {
      margin-top: 20px;
      font-size: 20px;
      font-weight: bold;
      white-space: pre-line;
    }
    .valid {
      color: green;
    }
    .invalid {
      color: red;
    }
  </style>
</head>
<body>
  <h1>Scanner votre Ticket</h1>
  <div id="qr-reader"></div>
  <div id="result"></div>

  <script>
    // Liste des tickets valides (en texte simple)
    const validTickets = [
      "TICKET-001",
      "cb7e55bc60d6bf55f5d8570b80a7edcc0f2ce11c7545783b2895f45348bfe389",
      "1285005e3f204b19fa7e9afeeea5a4aac3b229bbc8c5cebe26df81b84ecc5a29",
      "ENTREE-1234"
    ];

    // Dictionnaire des tickets scann√©s
    const scannedTickets = {};

    function onScanSuccess(qrCodeMessage) {
      const resultDiv = document.getElementById("result");
      const ticket = qrCodeMessage.trim();

      // Ticket non valide
      if (!validTickets.includes(ticket)) {
        resultDiv.textContent = `‚ùå Ticket invalide : ${ticket}`;
        resultDiv.className = "invalid";
        return;
      }

      // Ticket d√©j√† scann√©
      if (ticket in scannedTickets) {
        const info = scannedTickets[ticket];
        resultDiv.textContent = `‚ùå Ticket d√©j√† scann√© : ${ticket}\nüìÖ Le ${info.date} √† ${info.heure}`;
        resultDiv.className = "invalid";
        return;
      }

      // Nouveau ticket ‚Üí enregistrement
      const now = new Date();
      const date = now.toLocaleDateString("fr-FR");
      const heure = now.toLocaleTimeString("fr-FR");

      scannedTickets[ticket] = { date, heure };

      resultDiv.textContent = `‚úÖ Ticket valid√© : ${ticket}\nüìÖ Le ${date} √† ${heure}`;
      resultDiv.className = "valid";
    }

    function onScanFailure(error) {
      // Ignorer les erreurs de scan momentan√©es
    }

    const html5QrCode = new Html5Qrcode("qr-reader");
    html5QrCode.start(
      { facingMode: "environment" },
      {
        fps: 10,
        qrbox: { width: 250, height: 250 }
      },
      onScanSuccess,
      onScanFailure
    );
  </script>
</body>
</html>
